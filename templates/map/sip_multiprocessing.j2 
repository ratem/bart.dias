import multiprocessing
import itertools

def map_function({{ loop_var }}):
    {{ body | indent(4) }}

if __name__ == '__main__':
    # Determine number of processors
    num_procs = multiprocessing.cpu_count()
    data = {{ iter_expr }}

    # Create process pool
    with multiprocessing.Pool() as pool:
        # Process data in parallel using spatial instruction partitioning
        results = pool.map(map_function, data)
