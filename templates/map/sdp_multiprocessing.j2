import multiprocessing
import numpy as np

def map_function({{ loop_var }}):
    {{ body | indent(4) }}

if __name__ == '__main__':
    # Determine chunk size based on number of processors
    num_procs = multiprocessing.cpu_count()
    data = {{ iter_expr }}

    # Create chunks for spatial domain partitioning
    chunks = np.array_split(data, num_procs) if hasattr(data, '__len__') else data

    with multiprocessing.Pool() as pool:
        # Process chunks in parallel
        results = []
        for chunk_result in pool.map(map_function, chunks):
            results.extend(chunk_result)
